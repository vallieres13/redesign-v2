import { useRef } from 'react';
import gsap from 'gsap';
import { useGSAP } from '@gsap/react';

const InitialLoadOverlay = (props: any) => {
	if(localStorage.initialLoad) return;

	const progress = useRef<HTMLDivElement>(null);
	useGSAP(() => {
		gsap.fromTo('.indicator', {
			width: '0%'
		}, {
			width: '100%',
			ease: 'power4.out',
			duration: .85
		});
	}, { scope: progress });

	const overlay = useRef<HTMLDivElement>(null);
	useGSAP(() => {
		gsap.to(overlay, {
			onComplete: () => {
				props.hasFinished();
				if(overlay.current) overlay.current.classList.remove('show');

				gsap.to(overlay, {
					onComplete: () => {
						localStorage.initialLoad = true;
						if(overlay.current) overlay.current.style.visibility = 'hidden';
					},
					delay: .5,
				});
			},
			delay: .5
		});
	}, { scope: overlay });


	return (
		<div className="initialLoadOverlay show" ref={overlay}>
			{[...Array(10)].map((item: any, index: number) =>
				<div className="bar" key={index} />
			)}
			<div className="wrapper animate">
				<svg id="logo" className="animate" height="40" viewBox="0 0 139 25" fill="none" xmlns="http://www.w3.org/2000/svg">
					<path fill="none" strokeWidth="1" stroke="black" d="M3.952 19V8.808H0.676V6.104H3.952V3.712C3.952 2.828 4.212 2.126 4.732 1.606C5.26933 1.06867 5.96267 0.799999 6.812 0.799999H10.192V3.504H7.956C7.47067 3.504 7.228 3.764 7.228 4.284V6.104H10.608V8.808H7.228V19H3.952ZM17.5886 19.364C16.3059 19.364 15.1706 19.0953 14.1826 18.558C13.2119 18.0033 12.4492 17.232 11.8946 16.244C11.3572 15.2387 11.0886 14.06 11.0886 12.708V12.396C11.0886 11.044 11.3572 9.874 11.8946 8.886C12.4319 7.88067 13.1859 7.10933 14.1566 6.572C15.1272 6.01733 16.2539 5.74 17.5366 5.74C18.8019 5.74 19.9026 6.026 20.8386 6.598C21.7746 7.15267 22.5026 7.93267 23.0226 8.938C23.5426 9.926 23.8026 11.0787 23.8026 12.396V13.514H14.4166C14.4512 14.398 14.7806 15.1173 15.4046 15.672C16.0286 16.2267 16.7912 16.504 17.6926 16.504C18.6112 16.504 19.2872 16.3047 19.7206 15.906C20.1539 15.5073 20.4832 15.0653 20.7086 14.58L23.3866 15.984C23.1439 16.4347 22.7886 16.9287 22.3206 17.466C21.8699 17.986 21.2632 18.4367 20.5006 18.818C19.7379 19.182 18.7672 19.364 17.5886 19.364ZM14.4426 11.07H20.4746C20.4052 10.3247 20.1019 9.72667 19.5646 9.276C19.0446 8.82533 18.3599 8.6 17.5106 8.6C16.6266 8.6 15.9246 8.82533 15.4046 9.276C14.8846 9.72667 14.5639 10.3247 14.4426 11.07ZM25.7184 19V0.799999H28.9944V19H25.7184ZM31.6247 19V6.104H34.9007V19H31.6247ZM33.2627 4.596C32.6734 4.596 32.1707 4.40533 31.7547 4.024C31.356 3.64267 31.1567 3.14 31.1567 2.516C31.1567 1.892 31.356 1.38933 31.7547 1.008C32.1707 0.626666 32.6734 0.435999 33.2627 0.435999C33.8694 0.435999 34.372 0.626666 34.7707 1.008C35.1694 1.38933 35.3687 1.892 35.3687 2.516C35.3687 3.14 35.1694 3.64267 34.7707 4.024C34.372 4.40533 33.8694 4.596 33.2627 4.596ZM36.3869 19L41.0669 12.5L36.4389 6.104H40.2349L43.1729 10.394H43.6409L46.5789 6.104H50.3749L45.7469 12.5L50.4269 19H46.5789L43.6409 14.658H43.1729L40.2349 19H36.3869ZM51.9177 19V0.799999H55.1937V7.69H55.6617C55.8003 7.41267 56.017 7.13533 56.3117 6.858C56.6063 6.58067 56.9963 6.35533 57.4817 6.182C57.9843 5.99133 58.617 5.896 59.3797 5.896C60.385 5.896 61.2603 6.13 62.0057 6.598C62.7683 7.04867 63.3577 7.68133 63.7737 8.496C64.1897 9.29333 64.3977 10.2293 64.3977 11.304V19H61.1217V11.564C61.1217 10.5933 60.879 9.86533 60.3937 9.38C59.9257 8.89467 59.2497 8.652 58.3657 8.652C57.3603 8.652 56.5803 8.99 56.0257 9.666C55.471 10.3247 55.1937 11.252 55.1937 12.448V19H51.9177ZM72.8151 19.364C71.5325 19.364 70.3971 19.0953 69.4091 18.558C68.4385 18.0033 67.6758 17.232 67.1211 16.244C66.5838 15.2387 66.3151 14.06 66.3151 12.708V12.396C66.3151 11.044 66.5838 9.874 67.1211 8.886C67.6585 7.88067 68.4125 7.10933 69.3831 6.572C70.3538 6.01733 71.4805 5.74 72.7631 5.74C74.0285 5.74 75.1291 6.026 76.0651 6.598C77.0011 7.15267 77.7291 7.93267 78.2491 8.938C78.7691 9.926 79.0291 11.0787 79.0291 12.396V13.514H69.6431C69.6778 14.398 70.0071 15.1173 70.6311 15.672C71.2551 16.2267 72.0178 16.504 72.9191 16.504C73.8378 16.504 74.5138 16.3047 74.9471 15.906C75.3805 15.5073 75.7098 15.0653 75.9351 14.58L78.6131 15.984C78.3705 16.4347 78.0151 16.9287 77.5471 17.466C77.0965 17.986 76.4898 18.4367 75.7271 18.818C74.9645 19.182 73.9938 19.364 72.8151 19.364ZM69.6691 11.07H75.7011C75.6318 10.3247 75.3285 9.72667 74.7911 9.276C74.2711 8.82533 73.5865 8.6 72.7371 8.6C71.8531 8.6 71.1511 8.82533 70.6311 9.276C70.1111 9.72667 69.7905 10.3247 69.6691 11.07ZM88.693 19.364C87.5317 19.364 86.639 19.1647 86.015 18.766C85.391 18.3673 84.9317 17.9253 84.637 17.44H84.169V19H80.945V0.799999H84.221V7.586H84.689C84.8797 7.274 85.131 6.97933 85.443 6.702C85.7723 6.42467 86.197 6.19933 86.717 6.026C87.2543 5.83533 87.913 5.74 88.693 5.74C89.733 5.74 90.695 6 91.579 6.52C92.463 7.02267 93.1737 7.768 93.711 8.756C94.2483 9.744 94.517 10.94 94.517 12.344V12.76C94.517 14.164 94.2483 15.36 93.711 16.348C93.1737 17.336 92.463 18.09 91.579 18.61C90.695 19.1127 89.733 19.364 88.693 19.364ZM87.705 16.504C88.7103 16.504 89.551 16.1833 90.227 15.542C90.903 14.8833 91.241 13.93 91.241 12.682V12.422C91.241 11.174 90.903 10.2293 90.227 9.588C89.5683 8.92933 88.7277 8.6 87.705 8.6C86.6997 8.6 85.859 8.92933 85.183 9.588C84.507 10.2293 84.169 11.174 84.169 12.422V12.682C84.169 13.93 84.507 14.8833 85.183 15.542C85.859 16.1833 86.6997 16.504 87.705 16.504ZM95.9011 12.604V12.188C95.9011 10.836 96.1697 9.68333 96.7071 8.73C97.2444 7.75933 97.9551 7.02267 98.8391 6.52C99.7404 6 100.72 5.74 101.777 5.74C102.956 5.74 103.848 5.948 104.455 6.364C105.062 6.78 105.504 7.21333 105.781 7.664H106.249V6.104H109.473V21.288C109.473 22.172 109.213 22.874 108.693 23.394C108.173 23.9313 107.48 24.2 106.613 24.2H97.9811V21.34H105.469C105.954 21.34 106.197 21.08 106.197 20.56V17.206H105.729C105.556 17.4833 105.313 17.7693 105.001 18.064C104.689 18.3413 104.273 18.5753 103.753 18.766C103.233 18.9567 102.574 19.052 101.777 19.052C100.72 19.052 99.7404 18.8007 98.8391 18.298C97.9551 17.778 97.2444 17.0413 96.7071 16.088C96.1697 15.1173 95.9011 13.956 95.9011 12.604ZM102.713 16.192C103.718 16.192 104.559 15.8713 105.235 15.23C105.911 14.5887 106.249 13.6873 106.249 12.526V12.266C106.249 11.0873 105.911 10.186 105.235 9.562C104.576 8.92067 103.736 8.6 102.713 8.6C101.708 8.6 100.867 8.92067 100.191 9.562C99.5151 10.186 99.1771 11.0873 99.1771 12.266V12.526C99.1771 13.6873 99.5151 14.5887 100.191 15.23C100.867 15.8713 101.708 16.192 102.713 16.192ZM117.981 19.364C116.698 19.364 115.563 19.0953 114.575 18.558C113.604 18.0033 112.842 17.232 112.287 16.244C111.75 15.2387 111.481 14.06 111.481 12.708V12.396C111.481 11.044 111.75 9.874 112.287 8.886C112.824 7.88067 113.578 7.10933 114.549 6.572C115.52 6.01733 116.646 5.74 117.929 5.74C119.194 5.74 120.295 6.026 121.231 6.598C122.167 7.15267 122.895 7.93267 123.415 8.938C123.935 9.926 124.195 11.0787 124.195 12.396V13.514H114.809C114.844 14.398 115.173 15.1173 115.797 15.672C116.421 16.2267 117.184 16.504 118.085 16.504C119.004 16.504 119.68 16.3047 120.113 15.906C120.546 15.5073 120.876 15.0653 121.101 14.58L123.779 15.984C123.536 16.4347 123.181 16.9287 122.713 17.466C122.262 17.986 121.656 18.4367 120.893 18.818C120.13 19.182 119.16 19.364 117.981 19.364ZM114.835 11.07H120.867C120.798 10.3247 120.494 9.72667 119.957 9.276C119.437 8.82533 118.752 8.6 117.903 8.6C117.019 8.6 116.317 8.82533 115.797 9.276C115.277 9.72667 114.956 10.3247 114.835 11.07ZM126.111 19V6.104H129.335V7.794H129.803C130.011 7.34333 130.401 6.91867 130.973 6.52C131.545 6.104 132.412 5.896 133.573 5.896C134.578 5.896 135.454 6.13 136.199 6.598C136.962 7.04867 137.551 7.68133 137.967 8.496C138.383 9.29333 138.591 10.2293 138.591 11.304V19H135.315V11.564C135.315 10.5933 135.072 9.86533 134.587 9.38C134.119 8.89467 133.443 8.652 132.559 8.652C131.554 8.652 130.774 8.99 130.219 9.666C129.664 10.3247 129.387 11.252 129.387 12.448V19H126.111Z" />
				</svg>
				<div className="progress" ref={progress}><div className="indicator"></div></div>
			</div>
		</div>
	);
}

export default InitialLoadOverlay;